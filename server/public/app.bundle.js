(()=>{"use strict";function e(e,t){const o=document.createElement(e);return t&&(o.className=t),o}function t(e,t,o){e.forEach((e=>{let n,s,i;Array.isArray(e)?[n,s,i]=e:[n,s,i]=[e,t,o],n.style[s]=i}))}function o(e){return e[0].toUpperCase()+e.slice(1)}const n=document.body;new class{constructor(e,t){this.model=e,this.view=t,this.model.onBooksUpdated=this.onBooksUpdated.bind(this),this.view.onBookEdited=this.onBookEdited.bind(this),this.view.onBookDeleted=this.onBookDeleted.bind(this),this.view.onBookAdded=this.onBookAdded.bind(this)}onBooksUpdated(e){this.view.populateTable(e)}onBookEdited(e,t){return this.model.editBookById(e,t)}onBookDeleted(e){return this.model.deleteBookById(e)}onBookAdded(e){return this.model.addBook(e)}}(new class{constructor(){this.books=[],this.updateBooks(),this.onBooksUpdated=()=>{}}updateBooks(){this.constructor.getBooks().then((e=>{console.log(e),this.books=e,this.onBooksUpdated(e)}))}static getBooks(){return fetch("/api/books").then((e=>e.json()))}static getBookById(e){return fetch(`/api/books/${e}`).then((e=>e.json()))}addBook(e){return fetch("/api/books",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>{this.updateBooks(),e.json()}))}deleteBookById(e){return fetch(`/api/books/${e}`,{method:"DELETE"}).then((e=>{this.updateBooks(),e.json()}))}editBookById(e,t){return fetch(`/api/books/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>{this.updateBooks(),e.json()}))}},new class{constructor(e){this.parent=e,this.headers=["Id","Title","Author","Year","Description","Genres","Available","Sold","Price","Controls"],this.cellOrder=["id","title","author","year","description","genres","available","sold","price"],this.spinner=function(){const e=document.createElement("div");e.className="spinner-container";const t=document.createElement("div");t.className="lds-default";for(let e=0;e<12;e+=1){const e=document.createElement("div");t.append(e)}return e.toggle=()=>{e.style.display="none"===e.style.display?"flex":"none"},e.style.display="none",e.append(t),e}(),this.createTable(),this.table.append(this.spinner),e.append(this.table),this.placeholderBook={id:null,title:null,author:null,year:null,description:"By editing and saving this row you can add books. Id will be generated automatically.",genres:null,available:null,sold:null,price:null},this.onBookEdited=()=>{},this.onBookDeleted=()=>{},this.onBookAdded=()=>{}}createTable(){this.table=e("table","book-table"),this.thead=e("thead"),this.tbody=e("tbody"),this.createHeaderRow(),this.thead.append(this.headerRow),this.table.append(this.thead,this.tbody)}createHeaderRow(){return this.headerRow=document.createElement("tr"),this.headers.forEach((e=>{const t=document.createElement("th");t.textContent=e,this.headerRow.append(t)})),this.headerRow}populateTable(e){const t=document.createDocumentFragment(),o=this.createBookRow(this.placeholderBook);t.append(o),e.forEach((e=>{const o=this.createBookRow(e);t.append(o)})),this.tbody.innerHTML="",this.tbody.append(t)}createBookRow(o){const n=document.createElement("tr"),s=Object.entries(o),i=o.id;s.forEach((t=>{const[o,s]=t,i=e("td");switch(o){case"description":{const t=e("div","book-table__book-description");t.textContent=s,i.append(t);break}case"price":i.textContent=s?`$${s}`:"Not specified";break;case"genres":i.textContent=s?s.join(", "):"";break;default:i.textContent=s}n.append(i)}));const a=[...n.children],d=document.createElement("td"),l=Array(5).fill().map((()=>document.createElement("button"))),[r,c,h,p,u]=l;r.textContent="Edit",c.textContent="Cancel",h.textContent="Save",p.textContent="Delete",u.textContent="Yes",t([c,u,h],"display","none");const k=document.createElement("div");k.textContent="You sure about that?",k.hidden=!0;let b=null;return r.addEventListener("click",(()=>{a.forEach((e=>{e.contentEditable=!0})),t([r,p],"display","none"),t([c,h],"display","inline")})),c.addEventListener("click",(()=>{n.replaceWith(this.createBookRow(o))})),h.addEventListener("click",(()=>{const e=Object.create(o);a.forEach(((t,o)=>{t.contentEditable=!1,e[this.cellOrder[o]]=this.extractDataFromCell(t,o)})),console.log(e),b=()=>{this.spinner.toggle(),(()=>null===i?this.onBookAdded(e):this.onBookEdited(i,e))().finally((()=>{this.spinner.toggle()}))},t([[k,"display","block"],[h,"display","none"],[u,"display","inline"]])})),p.addEventListener("click",(()=>{b=()=>{this.spinner.toggle(),this.onBookDeleted(i).then((()=>{n.remove()})).finally((()=>{this.spinner.toggle()}))},t([r,p],"display","none"),t([c,u],"display","inline"),t([k],"display","block")})),u.addEventListener("click",(()=>{b(),b=null,t([k,u,c],"display","none"),t([r,p],"display","inline")})),d.append(k,r,c,u,p,h),n.append(d),n}extractDataFromCell(e,t){switch(this.cellOrder[t]){case"year":case"sold":case"available":return Number(e.textContent);case"genres":return e.textContent.split(/,\s{0,}/).filter((e=>""!==e)).map(o);case"price":{const t=e.textContent;return"$"===t[0]?Number(t.slice(1)):Number(t)}default:return e.textContent}}}(n))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jbGllbnQvLi9zcmMvbW9kdWxlcy9ib29rLWxpc3QvQm9va0xpc3RWaWV3LmpzIiwid2VicGFjazovL2NsaWVudC8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9jbGllbnQvLi9zcmMvbW9kdWxlcy9ib29rLWxpc3QvQm9va0xpc3RDb250cm9sbGVyLmpzIiwid2VicGFjazovL2NsaWVudC8uL3NyYy9tb2R1bGVzL2Jvb2stbGlzdC9Cb29rTGlzdE1vZGVsLmpzIl0sIm5hbWVzIjpbImNyZWF0ZUVsZW1lbnQiLCJ0YWciLCJjbGFzc05hbWUiLCJlbGVtZW50IiwiZG9jdW1lbnQiLCJzZXRTdHlsZXMiLCJxdWVyaWVzIiwiZGVmYXVsdFN0eWxlIiwiZGVmYXVsdFZhbHVlIiwiZm9yRWFjaCIsInF1ZXJ5Iiwic3R5bGUiLCJ2YWx1ZSIsIkFycmF5IiwiaXNBcnJheSIsImNhcGl0YWxpemUiLCJzdHIiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwicm9vdCIsImJvZHkiLCJtb2RlbCIsInZpZXciLCJ0aGlzIiwib25Cb29rc1VwZGF0ZWQiLCJiaW5kIiwib25Cb29rRWRpdGVkIiwib25Cb29rRGVsZXRlZCIsIm9uQm9va0FkZGVkIiwiYm9va3MiLCJwb3B1bGF0ZVRhYmxlIiwiYm9va0lkIiwiYm9vayIsImVkaXRCb29rQnlJZCIsImRlbGV0ZUJvb2tCeUlkIiwiYWRkQm9vayIsInVwZGF0ZUJvb2tzIiwiY29uc3RydWN0b3IiLCJnZXRCb29rcyIsInRoZW4iLCJjb25zb2xlIiwibG9nIiwiZmV0Y2giLCJyZXMiLCJqc29uIiwiaWQiLCJtZXRob2QiLCJKU09OIiwic3RyaW5naWZ5IiwiaGVhZGVycyIsInBhcmVudCIsImNlbGxPcmRlciIsInNwaW5uZXIiLCJzcGlubmVyQ29udGFpbmVyIiwiaSIsImNpcmNsZSIsImFwcGVuZCIsInRvZ2dsZSIsImRpc3BsYXkiLCJjcmVhdGVTcGlubmVyIiwiY3JlYXRlVGFibGUiLCJ0YWJsZSIsInBsYWNlaG9sZGVyQm9vayIsInRpdGxlIiwiYXV0aG9yIiwieWVhciIsImRlc2NyaXB0aW9uIiwiZ2VucmVzIiwiYXZhaWxhYmxlIiwic29sZCIsInByaWNlIiwidGhlYWQiLCJ0Ym9keSIsImNyZWF0ZUhlYWRlclJvdyIsImhlYWRlclJvdyIsImhlYWRlciIsInRkIiwidGV4dENvbnRlbnQiLCJyb3dzIiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsInBsYWNlaG9sZGVyQm9va1JvdyIsImNyZWF0ZUJvb2tSb3ciLCJ0ciIsImlubmVySFRNTCIsImVudHJpZXMiLCJPYmplY3QiLCJlbnRyeSIsImtleSIsImNvbnRhaW5lciIsImpvaW4iLCJlZGl0YWJsZUNlbGxzIiwiY2hpbGRyZW4iLCJjb250cm9sc0NlbGwiLCJidXR0b25zIiwiZmlsbCIsIm1hcCIsImVkaXRCdG4iLCJjYW5jZWxCdG4iLCJzYXZlQnRuIiwiZGVsZXRlQnRuIiwiY29uZmlybUJ0biIsImNvbmZpcm1UZXh0IiwiaGlkZGVuIiwiY29uZmlybUZ1bmN0aW9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNlbGwiLCJjb250ZW50RWRpdGFibGUiLCJyZXBsYWNlV2l0aCIsIm5ld0Jvb2siLCJjcmVhdGUiLCJleHRyYWN0RGF0YUZyb21DZWxsIiwiZmluYWxseSIsInJlbW92ZSIsImluZGV4SW5DZWxsT3JkZXIiLCJOdW1iZXIiLCJzcGxpdCIsImZpbHRlciIsImdlbnJlIiwidGV4dCJdLCJtYXBwaW5ncyI6Im1CQW1QQSxTQUFTQSxFQUFjQyxFQUFLQyxHQUMxQixNQUFNQyxFQUFVQyxTQUFTSixjQUFjQyxHQU12QyxPQUpJQyxJQUNGQyxFQUFRRCxVQUFZQSxHQUdmQyxFQUdULFNBQVNFLEVBQVVDLEVBQVNDLEVBQWNDLEdBQ3hDRixFQUFRRyxTQUFTQyxJQUNmLElBQUlQLEVBQWFRLEVBQVdDLEVBRXhCQyxNQUFNQyxRQUFRSixJQUNmUCxFQUFTUSxFQUFPQyxHQUFTRixHQUV6QlAsRUFBU1EsRUFBT0MsR0FBUyxDQUFDRixFQUFPSCxFQUFjQyxH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QUZrQjRCLEVBQUs1QixZQUNFc0MsTUFBTSxXQUFXQyxRQUFRQyxHQUFvQixLQUFWQSxJQUFjdEIsSUFBSWhGLEdBR2hGLElBQUssUUFBUyxDQUNaLE1BQU11RyxFQUFPYixFQUFLNUIsWUFDbEIsTUFBbUIsTUFBWnlDLEVBQUssR0FBYUosT0FBT0ksRUFBS3BHLE1BQU0sSUFBTWdHLE9BQU9JLEdBRTFELFFBQ0UsT0FBT2IsRUFBSzVCLGVDck80RDFELEsiLCJmaWxlIjoiYXBwLmJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIEJvb2tMaXN0VmlldyB7XG4gIGNvbnN0cnVjdG9yKHBhcmVudCkge1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgIHRoaXMuaGVhZGVycyA9IFtcbiAgICAgICdJZCcsXG4gICAgICAnVGl0bGUnLFxuICAgICAgJ0F1dGhvcicsXG4gICAgICAnWWVhcicsXG4gICAgICAnRGVzY3JpcHRpb24nLFxuICAgICAgJ0dlbnJlcycsXG4gICAgICAnQXZhaWxhYmxlJyxcbiAgICAgICdTb2xkJyxcbiAgICAgICdQcmljZScsXG4gICAgICAnQ29udHJvbHMnLFxuICAgIF07XG5cbiAgICB0aGlzLmNlbGxPcmRlciA9IFtcbiAgICAgICdpZCcsXG4gICAgICAndGl0bGUnLFxuICAgICAgJ2F1dGhvcicsXG4gICAgICAneWVhcicsXG4gICAgICAnZGVzY3JpcHRpb24nLFxuICAgICAgJ2dlbnJlcycsXG4gICAgICAnYXZhaWxhYmxlJyxcbiAgICAgICdzb2xkJyxcbiAgICAgICdwcmljZScsXG4gICAgXTtcblxuICAgIHRoaXMuc3Bpbm5lciA9IGNyZWF0ZVNwaW5uZXIoKTtcbiAgICB0aGlzLmNyZWF0ZVRhYmxlKCk7XG4gICAgdGhpcy50YWJsZS5hcHBlbmQodGhpcy5zcGlubmVyKTtcbiAgICBwYXJlbnQuYXBwZW5kKHRoaXMudGFibGUpO1xuXG4gICAgdGhpcy5wbGFjZWhvbGRlckJvb2sgPSB7XG4gICAgICBpZDogbnVsbCxcbiAgICAgIHRpdGxlOiBudWxsLFxuICAgICAgYXV0aG9yOiBudWxsLFxuICAgICAgeWVhcjogbnVsbCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQnkgZWRpdGluZyBhbmQgc2F2aW5nIHRoaXMgcm93IHlvdSBjYW4gYWRkIGJvb2tzLiBJZCB3aWxsIGJlIGdlbmVyYXRlZCBhdXRvbWF0aWNhbGx5LicsXG4gICAgICBnZW5yZXM6IG51bGwsXG4gICAgICBhdmFpbGFibGU6IG51bGwsXG4gICAgICBzb2xkOiBudWxsLFxuICAgICAgcHJpY2U6IG51bGwsXG4gICAgfTtcblxuICAgIHRoaXMub25Cb29rRWRpdGVkID0gKCkgPT4ge307XG4gICAgdGhpcy5vbkJvb2tEZWxldGVkID0gKCkgPT4ge307XG4gICAgdGhpcy5vbkJvb2tBZGRlZCA9ICgpID0+IHt9O1xuICB9XG5cbiAgY3JlYXRlVGFibGUoKSB7XG4gICAgdGhpcy50YWJsZSA9IGNyZWF0ZUVsZW1lbnQoJ3RhYmxlJywgJ2Jvb2stdGFibGUnKTtcbiAgICB0aGlzLnRoZWFkID0gY3JlYXRlRWxlbWVudCgndGhlYWQnKTtcbiAgICB0aGlzLnRib2R5ID0gY3JlYXRlRWxlbWVudCgndGJvZHknKTtcblxuICAgIHRoaXMuY3JlYXRlSGVhZGVyUm93KCk7XG4gICAgdGhpcy50aGVhZC5hcHBlbmQodGhpcy5oZWFkZXJSb3cpO1xuXG4gICAgdGhpcy50YWJsZS5hcHBlbmQodGhpcy50aGVhZCwgdGhpcy50Ym9keSk7XG4gIH1cblxuICBjcmVhdGVIZWFkZXJSb3coKSB7XG4gICAgdGhpcy5oZWFkZXJSb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgdGhpcy5oZWFkZXJzLmZvckVhY2goKGhlYWRlcikgPT4ge1xuICAgICAgY29uc3QgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0aCcpO1xuICAgICAgdGQudGV4dENvbnRlbnQgPSBoZWFkZXI7XG4gICAgICB0aGlzLmhlYWRlclJvdy5hcHBlbmQodGQpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuaGVhZGVyUm93O1xuICB9XG5cbiAgcG9wdWxhdGVUYWJsZShib29rcykge1xuICAgIGNvbnN0IHJvd3MgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICBjb25zdCBwbGFjZWhvbGRlckJvb2tSb3cgPSB0aGlzLmNyZWF0ZUJvb2tSb3codGhpcy5wbGFjZWhvbGRlckJvb2spO1xuICAgIHJvd3MuYXBwZW5kKHBsYWNlaG9sZGVyQm9va1Jvdyk7XG5cbiAgICBib29rcy5mb3JFYWNoKChib29rKSA9PiB7XG4gICAgICBjb25zdCB0ciA9IHRoaXMuY3JlYXRlQm9va1Jvdyhib29rKTtcbiAgICAgIHJvd3MuYXBwZW5kKHRyKTtcbiAgICB9KTtcblxuICAgIHRoaXMudGJvZHkuaW5uZXJIVE1MID0gJyc7XG4gICAgdGhpcy50Ym9keS5hcHBlbmQocm93cyk7XG4gIH1cblxuICBjcmVhdGVCb29rUm93KGJvb2spIHtcbiAgICBjb25zdCB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG4gICAgY29uc3QgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGJvb2spO1xuICAgIGNvbnN0IGJvb2tJZCA9IGJvb2suaWQ7XG5cbiAgICBlbnRyaWVzLmZvckVhY2goKGVudHJ5KSA9PiB7XG4gICAgICBjb25zdCBba2V5LCB2YWx1ZV0gPSBlbnRyeTtcbiAgICAgIGNvbnN0IHRkID0gY3JlYXRlRWxlbWVudCgndGQnKTtcblxuICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgY2FzZSAnZGVzY3JpcHRpb24nOiB7XG4gICAgICAgICAgY29uc3QgY29udGFpbmVyID0gY3JlYXRlRWxlbWVudCgnZGl2JywgJ2Jvb2stdGFibGVfX2Jvb2stZGVzY3JpcHRpb24nKTtcbiAgICAgICAgICBjb250YWluZXIudGV4dENvbnRlbnQgPSB2YWx1ZTtcbiAgICAgICAgICB0ZC5hcHBlbmQoY29udGFpbmVyKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdwcmljZSc6IHtcbiAgICAgICAgICB0ZC50ZXh0Q29udGVudCA9IHZhbHVlID8gYCQke3ZhbHVlfWAgOiAnTm90IHNwZWNpZmllZCc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSAnZ2VucmVzJzoge1xuICAgICAgICAgIHRkLnRleHRDb250ZW50ID0gdmFsdWUgPyB2YWx1ZS5qb2luKCcsICcpIDogJyc7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgIHRkLnRleHRDb250ZW50ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdHIuYXBwZW5kKHRkKTtcbiAgICB9KTtcblxuICAgIC8qIENvbnRyb2wgaGFuZGxpbmcgKi9cbiAgICBjb25zdCBlZGl0YWJsZUNlbGxzID0gWy4uLnRyLmNoaWxkcmVuXTtcbiAgICBjb25zdCBjb250cm9sc0NlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuXG4gICAgY29uc3QgYnV0dG9ucyA9IEFycmF5KDUpLmZpbGwoKS5tYXAoKCkgPT4gKFxuICAgICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJylcbiAgICApKTtcblxuICAgIGNvbnN0IFtlZGl0QnRuLCBjYW5jZWxCdG4sIHNhdmVCdG4sIGRlbGV0ZUJ0biwgY29uZmlybUJ0bl0gPSBidXR0b25zO1xuICAgIGVkaXRCdG4udGV4dENvbnRlbnQgPSAnRWRpdCc7XG4gICAgY2FuY2VsQnRuLnRleHRDb250ZW50ID0gJ0NhbmNlbCc7XG4gICAgc2F2ZUJ0bi50ZXh0Q29udGVudCA9ICdTYXZlJztcbiAgICBkZWxldGVCdG4udGV4dENvbnRlbnQgPSAnRGVsZXRlJztcbiAgICBjb25maXJtQnRuLnRleHRDb250ZW50ID0gJ1llcyc7XG5cbiAgICBzZXRTdHlsZXMoW2NhbmNlbEJ0biwgY29uZmlybUJ0biwgc2F2ZUJ0bl0sICdkaXNwbGF5JywgJ25vbmUnKTtcblxuICAgIGNvbnN0IGNvbmZpcm1UZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgY29uZmlybVRleHQudGV4dENvbnRlbnQgPSAnWW91IHN1cmUgYWJvdXQgdGhhdD8nO1xuICAgIGNvbmZpcm1UZXh0LmhpZGRlbiA9IHRydWU7XG5cbiAgICBsZXQgY29uZmlybUZ1bmN0aW9uID0gbnVsbDtcblxuICAgIGVkaXRCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBlZGl0YWJsZUNlbGxzLmZvckVhY2goKGNlbGwpID0+IHtcbiAgICAgICAgY2VsbC5jb250ZW50RWRpdGFibGUgPSB0cnVlO1xuICAgICAgfSk7XG5cbiAgICAgIHNldFN0eWxlcyhbZWRpdEJ0biwgZGVsZXRlQnRuXSwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgc2V0U3R5bGVzKFtjYW5jZWxCdG4sIHNhdmVCdG5dLCAnZGlzcGxheScsICdpbmxpbmUnKTtcbiAgICB9KTtcblxuICAgIGNhbmNlbEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIHRyLnJlcGxhY2VXaXRoKHRoaXMuY3JlYXRlQm9va1Jvdyhib29rKSk7XG4gICAgfSk7XG5cbiAgICBzYXZlQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgY29uc3QgbmV3Qm9vayA9IE9iamVjdC5jcmVhdGUoYm9vayk7XG5cbiAgICAgIGVkaXRhYmxlQ2VsbHMuZm9yRWFjaCgoY2VsbCwgaSkgPT4ge1xuICAgICAgICBjZWxsLmNvbnRlbnRFZGl0YWJsZSA9IGZhbHNlO1xuICAgICAgICBuZXdCb29rW3RoaXMuY2VsbE9yZGVyW2ldXSA9IHRoaXMuZXh0cmFjdERhdGFGcm9tQ2VsbChjZWxsLCBpKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zb2xlLmxvZyhuZXdCb29rKTtcblxuICAgICAgY29uZmlybUZ1bmN0aW9uID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnNwaW5uZXIudG9nZ2xlKCk7XG4gICAgICAgICgoKSA9PiB7XG4gICAgICAgICAgaWYgKGJvb2tJZCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub25Cb29rQWRkZWQobmV3Qm9vayk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIHRoaXMub25Cb29rRWRpdGVkKGJvb2tJZCwgbmV3Qm9vayk7XG4gICAgICAgIH0pKCkuZmluYWxseSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5zcGlubmVyLnRvZ2dsZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHNldFN0eWxlcyhbXG4gICAgICAgIFtjb25maXJtVGV4dCwgJ2Rpc3BsYXknLCAnYmxvY2snXSxcbiAgICAgICAgW3NhdmVCdG4sICdkaXNwbGF5JywgJ25vbmUnXSxcbiAgICAgICAgW2NvbmZpcm1CdG4sICdkaXNwbGF5JywgJ2lubGluZSddLFxuICAgICAgXSk7XG4gICAgfSk7XG5cbiAgICBkZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBjb25maXJtRnVuY3Rpb24gPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc3Bpbm5lci50b2dnbGUoKTtcbiAgICAgICAgdGhpcy5vbkJvb2tEZWxldGVkKGJvb2tJZClcbiAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0ci5yZW1vdmUoKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3Bpbm5lci50b2dnbGUoKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIHNldFN0eWxlcyhbZWRpdEJ0biwgZGVsZXRlQnRuXSwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgc2V0U3R5bGVzKFtjYW5jZWxCdG4sIGNvbmZpcm1CdG5dLCAnZGlzcGxheScsICdpbmxpbmUnKTtcbiAgICAgIHNldFN0eWxlcyhbY29uZmlybVRleHRdLCAnZGlzcGxheScsICdibG9jaycpO1xuICAgIH0pO1xuXG4gICAgY29uZmlybUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGNvbmZpcm1GdW5jdGlvbigpO1xuICAgICAgY29uZmlybUZ1bmN0aW9uID0gbnVsbDtcblxuICAgICAgc2V0U3R5bGVzKFtjb25maXJtVGV4dCwgY29uZmlybUJ0biwgY2FuY2VsQnRuXSwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuICAgICAgc2V0U3R5bGVzKFtlZGl0QnRuLCBkZWxldGVCdG5dLCAnZGlzcGxheScsICdpbmxpbmUnKTtcbiAgICB9KTtcblxuICAgIGNvbnRyb2xzQ2VsbC5hcHBlbmQoY29uZmlybVRleHQsIGVkaXRCdG4sIGNhbmNlbEJ0biwgY29uZmlybUJ0biwgZGVsZXRlQnRuLCBzYXZlQnRuKTtcbiAgICB0ci5hcHBlbmQoY29udHJvbHNDZWxsKTtcbiAgICAvKiBFbmQgQ29udHJvbCBoYW5kbGluZyAqL1xuXG4gICAgcmV0dXJuIHRyO1xuICB9XG5cbiAgZXh0cmFjdERhdGFGcm9tQ2VsbChjZWxsLCBpbmRleEluQ2VsbE9yZGVyKSB7XG4gICAgY29uc3QgY2VsbFR5cGUgPSB0aGlzLmNlbGxPcmRlcltpbmRleEluQ2VsbE9yZGVyXTtcblxuICAgIHN3aXRjaCAoY2VsbFR5cGUpIHtcbiAgICAgIGNhc2UgJ3llYXInOlxuICAgICAgY2FzZSAnc29sZCc6XG4gICAgICBjYXNlICdhdmFpbGFibGUnOiB7XG4gICAgICAgIHJldHVybiBOdW1iZXIoY2VsbC50ZXh0Q29udGVudCk7XG4gICAgICB9XG4gICAgICBjYXNlICdnZW5yZXMnOiB7XG4gICAgICAgIGNvbnN0IGdlbnJlc1N0ciA9IGNlbGwudGV4dENvbnRlbnQ7XG4gICAgICAgIGNvbnN0IGdlbnJlcyA9IGdlbnJlc1N0ci5zcGxpdCgvLFxcc3swLH0vKS5maWx0ZXIoKGdlbnJlKSA9PiBnZW5yZSAhPT0gJycpLm1hcChjYXBpdGFsaXplKTtcbiAgICAgICAgcmV0dXJuIGdlbnJlcztcbiAgICAgIH1cbiAgICAgIGNhc2UgJ3ByaWNlJzoge1xuICAgICAgICBjb25zdCB0ZXh0ID0gY2VsbC50ZXh0Q29udGVudDtcbiAgICAgICAgcmV0dXJuIHRleHRbMF0gPT09ICckJyA/IE51bWJlcih0ZXh0LnNsaWNlKDEpKSA6IE51bWJlcih0ZXh0KTtcbiAgICAgIH1cbiAgICAgIGRlZmF1bHQ6IHtcbiAgICAgICAgcmV0dXJuIGNlbGwudGV4dENvbnRlbnQ7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnQodGFnLCBjbGFzc05hbWUpIHtcbiAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcblxuICBpZiAoY2xhc3NOYW1lKSB7XG4gICAgZWxlbWVudC5jbGFzc05hbWUgPSBjbGFzc05hbWU7XG4gIH1cblxuICByZXR1cm4gZWxlbWVudDtcbn1cblxuZnVuY3Rpb24gc2V0U3R5bGVzKHF1ZXJpZXMsIGRlZmF1bHRTdHlsZSwgZGVmYXVsdFZhbHVlKSB7XG4gIHF1ZXJpZXMuZm9yRWFjaCgocXVlcnkpID0+IHtcbiAgICBsZXQgZWxlbWVudDsgbGV0IHN0eWxlOyBsZXQgdmFsdWU7XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShxdWVyeSkpIHtcbiAgICAgIFtlbGVtZW50LCBzdHlsZSwgdmFsdWVdID0gcXVlcnk7XG4gICAgfSBlbHNlIHtcbiAgICAgIFtlbGVtZW50LCBzdHlsZSwgdmFsdWVdID0gW3F1ZXJ5LCBkZWZhdWx0U3R5bGUsIGRlZmF1bHRWYWx1ZV07XG4gICAgfVxuXG4gICAgZWxlbWVudC5zdHlsZVtzdHlsZV0gPSB2YWx1ZTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNhcGl0YWxpemUoc3RyKSB7XG4gIHJldHVybiBzdHJbMF0udG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3Bpbm5lcigpIHtcbiAgY29uc3QgTlVNQkVSX09GX0NJUkNMRVMgPSAxMjtcbiAgY29uc3Qgc3Bpbm5lckNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBzcGlubmVyQ29udGFpbmVyLmNsYXNzTmFtZSA9ICdzcGlubmVyLWNvbnRhaW5lcic7XG5cbiAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBzcGlubmVyLmNsYXNzTmFtZSA9ICdsZHMtZGVmYXVsdCc7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1CRVJfT0ZfQ0lSQ0xFUzsgaSArPSAxKSB7XG4gICAgY29uc3QgY2lyY2xlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgc3Bpbm5lci5hcHBlbmQoY2lyY2xlKTtcbiAgfVxuXG4gIHNwaW5uZXJDb250YWluZXIudG9nZ2xlID0gKCkgPT4ge1xuICAgIHNwaW5uZXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9IHNwaW5uZXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9PT0gJ25vbmUnID8gJ2ZsZXgnIDogJ25vbmUnO1xuICB9O1xuXG4gIHNwaW5uZXJDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgc3Bpbm5lckNvbnRhaW5lci5hcHBlbmQoc3Bpbm5lcik7XG5cbiAgcmV0dXJuIHNwaW5uZXJDb250YWluZXI7XG59XG4iLCJpbXBvcnQgJy4vY3NzL21haW4uY3NzJztcblxuaW1wb3J0IEJvb2tMaXN0VmlldyBmcm9tICcuL21vZHVsZXMvYm9vay1saXN0L0Jvb2tMaXN0Vmlldyc7XG5pbXBvcnQgQm9va0xpc3RDb250cm9sbGVyIGZyb20gJy4vbW9kdWxlcy9ib29rLWxpc3QvQm9va0xpc3RDb250cm9sbGVyJztcbmltcG9ydCBCb29rTGlzdE1vZGVsIGZyb20gJy4vbW9kdWxlcy9ib29rLWxpc3QvQm9va0xpc3RNb2RlbCc7XG5cbmNvbnN0IHJvb3QgPSBkb2N1bWVudC5ib2R5O1xuXG5jb25zdCBjb250cm9sbGVyID0gbmV3IEJvb2tMaXN0Q29udHJvbGxlcihuZXcgQm9va0xpc3RNb2RlbCgpLCBuZXcgQm9va0xpc3RWaWV3KHJvb3QpKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEJvb2tMaXN0Q29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKG1vZGVsLCB2aWV3KSB7XG4gICAgdGhpcy5tb2RlbCA9IG1vZGVsO1xuICAgIHRoaXMudmlldyA9IHZpZXc7XG5cbiAgICB0aGlzLm1vZGVsLm9uQm9va3NVcGRhdGVkID0gdGhpcy5vbkJvb2tzVXBkYXRlZC5iaW5kKHRoaXMpO1xuICAgIHRoaXMudmlldy5vbkJvb2tFZGl0ZWQgPSB0aGlzLm9uQm9va0VkaXRlZC5iaW5kKHRoaXMpO1xuICAgIHRoaXMudmlldy5vbkJvb2tEZWxldGVkID0gdGhpcy5vbkJvb2tEZWxldGVkLmJpbmQodGhpcyk7XG4gICAgdGhpcy52aWV3Lm9uQm9va0FkZGVkID0gdGhpcy5vbkJvb2tBZGRlZC5iaW5kKHRoaXMpO1xuICB9XG5cbiAgb25Cb29rc1VwZGF0ZWQoYm9va3MpIHtcbiAgICB0aGlzLnZpZXcucG9wdWxhdGVUYWJsZShib29rcyk7XG4gIH1cblxuICBvbkJvb2tFZGl0ZWQoYm9va0lkLCBib29rKSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuZWRpdEJvb2tCeUlkKGJvb2tJZCwgYm9vayk7XG4gIH1cblxuICBvbkJvb2tEZWxldGVkKGJvb2tJZCkge1xuICAgIHJldHVybiB0aGlzLm1vZGVsLmRlbGV0ZUJvb2tCeUlkKGJvb2tJZCk7XG4gIH1cblxuICBvbkJvb2tBZGRlZChib29rKSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuYWRkQm9vayhib29rKTtcbiAgfVxufVxuIiwiY29uc3QgQVBJX1JPT1QgPSAnL2FwaSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEJvb2tMaXN0TW9kZWwge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmJvb2tzID0gW107XG4gICAgdGhpcy51cGRhdGVCb29rcygpO1xuICAgIHRoaXMub25Cb29rc1VwZGF0ZWQgPSAoKSA9PiB7fTtcbiAgfVxuXG4gIHVwZGF0ZUJvb2tzKCkge1xuICAgIHRoaXMuY29uc3RydWN0b3IuZ2V0Qm9va3MoKVxuICAgICAgLnRoZW4oKGJvb2tzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGJvb2tzKTtcbiAgICAgICAgdGhpcy5ib29rcyA9IGJvb2tzO1xuICAgICAgICB0aGlzLm9uQm9va3NVcGRhdGVkKGJvb2tzKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGdldEJvb2tzKCkge1xuICAgIHJldHVybiBmZXRjaChgJHtBUElfUk9PVH0vYm9va3NgKVxuICAgICAgLnRoZW4oKHJlcykgPT4gcmVzLmpzb24oKSk7XG4gIH1cblxuICBzdGF0aWMgZ2V0Qm9va0J5SWQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7QVBJX1JPT1R9L2Jvb2tzLyR7aWR9YClcbiAgICAgIC50aGVuKChyZXMpID0+IHJlcy5qc29uKCkpO1xuICB9XG5cbiAgYWRkQm9vayhib29rKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke0FQSV9ST09UfS9ib29rc2AsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9vayksXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdGhpcy51cGRhdGVCb29rcygpO1xuICAgICAgcmVzLmpzb24oKTtcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUJvb2tCeUlkKGlkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke0FQSV9ST09UfS9ib29rcy8ke2lkfWAsIHsgbWV0aG9kOiAnREVMRVRFJyB9KVxuICAgICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICB0aGlzLnVwZGF0ZUJvb2tzKCk7XG4gICAgICAgIHJlcy5qc29uKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIGVkaXRCb29rQnlJZChpZCwgYm9vaykge1xuICAgIHJldHVybiBmZXRjaChgJHtBUElfUk9PVH0vYm9va3MvJHtpZH1gLCB7XG4gICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9vayksXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICB9LFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdGhpcy51cGRhdGVCb29rcygpO1xuICAgICAgcmVzLmpzb24oKTtcbiAgICB9KTtcbiAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==