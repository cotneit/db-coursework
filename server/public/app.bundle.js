(()=>{"use strict";function e(e,t){const o=document.createElement(e);return t&&(o.className=t),o}function t(e,t,o){e.forEach((e=>{let n,s,i;Array.isArray(e)?[n,s,i]=e:[n,s,i]=[e,t,o],n.style[s]=i}))}function o(e){return e[0].toUpperCase()+e.slice(1)}const n=document.body;new class{constructor(e,t){this.model=e,this.view=t,this.model.onBooksUpdated=this.onBooksUpdated.bind(this),this.view.onBookEdited=this.onBookEdited.bind(this),this.view.onBookDeleted=this.onBookDeleted.bind(this),this.view.onBookAdded=this.onBookAdded.bind(this)}onBooksUpdated(e){this.view.populateTable(e)}onBookEdited(e,t){return this.model.editBookById(e,t)}onBookDeleted(e){return this.model.deleteBookById(e)}onBookAdded(e){return this.model.addBook(e)}}(new class{constructor(){this.books=[],this.updateBooks(),this.onBooksUpdated=()=>{}}updateBooks(){this.constructor.getBooks().then((e=>{console.log(e),this.books=e,this.onBooksUpdated(e)}))}static getBooks(){return fetch("/api/books").then((e=>e.json()))}static getBookById(e){return fetch(`/api/books/${e}`).then((e=>e.json()))}addBook(e){return fetch("/api/books",{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>{this.updateBooks(),e.json()}))}deleteBookById(e){return fetch(`/api/books/${e}`,{method:"DELETE"}).then((e=>{this.updateBooks(),e.json()}))}editBookById(e,t){return fetch(`/api/books/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>{this.updateBooks(),e.json()}))}},new class{constructor(e){this.parent=e,this.headers=["Id","Title","Author","Year","Description","Genres","Available","Sold","Price","Controls"],this.cellOrder=["id","title","author","year","description","genres","available","sold","price"],this.spinner=function(){const e=document.createElement("div");e.className="spinner-container";const t=document.createElement("div");t.className="lds-default";for(let e=0;e<12;e+=1){const e=document.createElement("div");t.append(e)}return e.toggle=()=>{e.style.display="none"===e.style.display?"flex":"none"},e.style.display="none",e.append(t),e}(),this.createTable(),e.append(this.table),this.placeholderBook={id:null,title:null,author:null,year:null,description:"By editing and saving this row you can add books. Id will be generated automatically.",genres:null,available:null,sold:null,price:null},this.onBookEdited=()=>{},this.onBookDeleted=()=>{},this.onBookAdded=()=>{}}createTable(){this.table=e("table","book-table"),this.thead=e("thead"),this.tbody=e("tbody"),this.createHeaderRow(),this.thead.append(this.headerRow),this.table.append(this.thead,this.tbody)}createHeaderRow(){return this.headerRow=document.createElement("tr"),this.headers.forEach((e=>{const t=document.createElement("th");t.textContent=e,this.headerRow.append(t)})),this.headerRow}populateTable(e){const t=document.createDocumentFragment(),o=this.createBookRow(this.placeholderBook);t.append(o),e.forEach((e=>{const o=this.createBookRow(e);t.append(o)})),this.tbody.innerHTML="",this.tbody.append(t)}createBookRow(o){const n=document.createElement("tr"),s=Object.entries(o),i=o.id;s.forEach((t=>{const[o,s]=t,i=e("td");switch(o){case"description":{const t=e("div","book-table__book-description");t.textContent=s,i.append(t);break}case"price":i.textContent=s?`$${s}`:"Not specified";break;case"genres":i.textContent=s?s.join(", "):"";break;default:i.textContent=s}n.append(i)}));const d=[...n.children],a=document.createElement("td"),l=Array(5).fill().map((()=>document.createElement("button"))),[r,c,h,p,u]=l;r.textContent="Edit",c.textContent="Cancel",h.textContent="Save",p.textContent="Delete",u.textContent="Yes",t([c,u,h],"display","none");const k=document.createElement("div");k.textContent="You sure about that?",k.hidden=!0;let b=null;return r.addEventListener("click",(()=>{d.forEach((e=>{e.contentEditable=!0})),t([r,p],"display","none"),t([c,h],"display","inline")})),c.addEventListener("click",(()=>{n.replaceWith(this.createBookRow(o))})),h.addEventListener("click",(()=>{const e=Object.create(o);d.forEach(((t,o)=>{t.contentEditable=!1,e[this.cellOrder[o]]=this.extractDataFromCell(t,o)})),console.log(e),b=()=>{this.spinner.toggle(),(()=>null===i?this.onBookAdded(e):this.onBookEdited(i,e))().finally((()=>{this.spinner.toggle()}))},t([[k,"display","block"],[h,"display","none"],[u,"display","inline"]])})),p.addEventListener("click",(()=>{b=()=>{this.spinner.toggle(),this.onBookDeleted(i).then((()=>{n.remove()})).finally((()=>{this.spinner.toggle()}))},t([r,p],"display","none"),t([c,u],"display","inline"),t([k],"display","block")})),u.addEventListener("click",(()=>{b(),b=null,t([k,u,c],"display","none"),t([r,p],"display","inline")})),a.append(k,r,c,u,p,h),n.append(a),n}extractDataFromCell(e,t){switch(this.cellOrder[t]){case"year":case"sold":case"available":return Number(e.textContent);case"genres":return e.textContent.split(/,\s{0,}/).filter((e=>""!==e)).map(o);case"price":{const t=e.textContent;return"$"===t[0]?Number(t.slice(1)):Number(t)}default:return e.textContent}}}(n))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jbGllbnQvLi9zcmMvbW9kdWxlcy9ib29rLWxpc3QvQm9va0xpc3RWaWV3LmpzIiwid2VicGFjazovL2NsaWVudC8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly9jbGllbnQvLi9zcmMvbW9kdWxlcy9ib29rLWxpc3QvQm9va0xpc3RDb250cm9sbGVyLmpzIiwid2VicGFjazovL2NsaWVudC8uL3NyYy9tb2R1bGVzL2Jvb2stbGlzdC9Cb29rTGlzdE1vZGVsLmpzIl0sIm5hbWVzIjpbImNyZWF0ZUVsZW1lbnQiLCJ0YWciLCJjbGFzc05hbWUiLCJlbGVtZW50IiwiZG9jdW1lbnQiLCJzZXRTdHlsZXMiLCJxdWVyaWVzIiwiZGVmYXVsdFN0eWxlIiwiZGVmYXVsdFZhbHVlIiwiZm9yRWFjaCIsInF1ZXJ5Iiwic3R5bGUiLCJ2YWx1ZSIsIkFycmF5IiwiaXNBcnJheSIsImNhcGl0YWxpemUiLCJzdHIiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwicm9vdCIsImJvZHkiLCJtb2RlbCIsInZpZXciLCJ0aGlzIiwib25Cb29rc1VwZGF0ZWQiLCJiaW5kIiwib25Cb29rRWRpdGVkIiwib25Cb29rRGVsZXRlZCIsIm9uQm9va0FkZGVkIiwiYm9va3MiLCJwb3B1bGF0ZVRhYmxlIiwiYm9va0lkIiwiYm9vayIsImVkaXRCb29rQnlJZCIsImRlbGV0ZUJvb2tCeUlkIiwiYWRkQm9vayIsInVwZGF0ZUJvb2tzIiwiY29uc3RydWN0b3IiLCJnZXRCb29rcyIsInRoZW4iLCJjb25zb2xlIiwibG9nIiwiZmV0Y2giLCJyZXMiLCJqc29uIiwiaWQiLCJtZXRob2QiLCJKU09OIiwic3RyaW5naWZ5IiwiaGVhZGVycyIsInBhcmVudCIsImNlbGxPcmRlciIsInNwaW5uZXIiLCJzcGlubmVyQ29udGFpbmVyIiwiaSIsImNpcmNsZSIsImFwcGVuZCIsInRvZ2dsZSIsImRpc3BsYXkiLCJjcmVhdGVTcGlubmVyIiwiY3JlYXRlVGFibGUiLCJ0YWJsZSIsInBsYWNlaG9sZGVyQm9vayIsInRpdGxlIiwiYXV0aG9yIiwieWVhciIsImRlc2NyaXB0aW9uIiwiZ2VucmVzIiwiYXZhaWxhYmxlIiwic29sZCIsInByaWNlIiwidGhlYWQiLCJ0Ym9keSIsImNyZWF0ZUhlYWRlclJvdyIsImhlYWRlclJvdyIsImhlYWRlciIsInRkIiwidGV4dENvbnRlbnQiLCJyb3dzIiwiY3JlYXRlRG9jdW1lbnRGcmFnbWVudCIsInBsYWNlaG9sZGVyQm9va1JvdyIsImNyZWF0ZUJvb2tSb3ciLCJ0ciIsImlubmVySFRNTCIsImVudHJpZXMiLCJPYmplY3QiLCJlbnRyeSIsImtleSIsImNvbnRhaW5lciIsImpvaW4iLCJlZGl0YWJsZUNlbGxzIiwiY2hpbGRyZW4iLCJjb250cm9sc0NlbGwiLCJidXR0b25zIiwiZmlsbCIsIm1hcCIsImVkaXRCdG4iLCJjYW5jZWxCdG4iLCJzYXZlQnRuIiwiZGVsZXRlQnRuIiwiY29uZmlybUJ0biIsImNvbmZpcm1UZXh0IiwiaGlkZGVuIiwiY29uZmlybUZ1bmN0aW9uIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNlbGwiLCJjb250ZW50RWRpdGFibGUiLCJyZXBsYWNlV2l0aCIsIm5ld0Jvb2siLCJjcmVhdGUiLCJleHRyYWN0RGF0YUZyb21DZWxsIiwiZmluYWxseSIsInJlbW92ZSIsImluZGV4SW5DZWxsT3JkZXIiLCJOdW1iZXIiLCJzcGxpdCIsImZpbHRlciIsImdlbnJlIiwidGV4dCJdLCJtYXBwaW5ncyI6Im1CQWtQQSxTQUFTQSxFQUFjQyxFQUFLQyxHQUMxQixNQUFNQyxFQUFVQyxTQUFTSixjQUFjQyxHQU12QyxPQUpJQyxJQUNGQyxFQUFRRCxVQUFZQSxHQUdmQyxFQUdULFNBQVNFLEVBQVVDLEVBQVNDLEVBQWNDLEdBQ3hDRixFQUFRRyxTQUFTQyxJQUNmLElBQUlQLEVBQWFRLEVBQVdDLEVBRXhCQyxNQUFNQyxRQUFRSixJQUNmUCxFQUFTUSxFQUFPQyxHQUFTRixHQUV6QlAsRUFBU1EsRUFBT0MsR0FBUyxDQUFDRixFQUFPSCxFQUFjQyxH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UUMsR0FBb0IsS0FBVkEsSUFBY3RCLElBQUloRixHQUdoRixJQUFLLFFBQVMsQ0FDWixNQUFNdUcsRUFBT2IsRUFBSzVCLFlBQ2xCLE1BQW1CLE1BQVp5QyxFQUFLLEdBQWFKLE9BQU9JLEVBQUtwRyxNQUFNLElBQU1nRyxPQUFPSSxHQUUxRCxRQUNFLE9BQU9iLEVBQUs1QixlQ3BPNEQxRCxLIiwiZmlsZSI6ImFwcC5idW5kbGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBCb29rTGlzdFZpZXcge1xuICBjb25zdHJ1Y3RvcihwYXJlbnQpIHtcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICB0aGlzLmhlYWRlcnMgPSBbXG4gICAgICAnSWQnLFxuICAgICAgJ1RpdGxlJyxcbiAgICAgICdBdXRob3InLFxuICAgICAgJ1llYXInLFxuICAgICAgJ0Rlc2NyaXB0aW9uJyxcbiAgICAgICdHZW5yZXMnLFxuICAgICAgJ0F2YWlsYWJsZScsXG4gICAgICAnU29sZCcsXG4gICAgICAnUHJpY2UnLFxuICAgICAgJ0NvbnRyb2xzJyxcbiAgICBdO1xuXG4gICAgdGhpcy5jZWxsT3JkZXIgPSBbXG4gICAgICAnaWQnLFxuICAgICAgJ3RpdGxlJyxcbiAgICAgICdhdXRob3InLFxuICAgICAgJ3llYXInLFxuICAgICAgJ2Rlc2NyaXB0aW9uJyxcbiAgICAgICdnZW5yZXMnLFxuICAgICAgJ2F2YWlsYWJsZScsXG4gICAgICAnc29sZCcsXG4gICAgICAncHJpY2UnLFxuICAgIF07XG5cbiAgICB0aGlzLnNwaW5uZXIgPSBjcmVhdGVTcGlubmVyKCk7XG4gICAgdGhpcy5jcmVhdGVUYWJsZSgpO1xuICAgIHBhcmVudC5hcHBlbmQodGhpcy50YWJsZSk7XG5cbiAgICB0aGlzLnBsYWNlaG9sZGVyQm9vayA9IHtcbiAgICAgIGlkOiBudWxsLFxuICAgICAgdGl0bGU6IG51bGwsXG4gICAgICBhdXRob3I6IG51bGwsXG4gICAgICB5ZWFyOiBudWxsLFxuICAgICAgZGVzY3JpcHRpb246ICdCeSBlZGl0aW5nIGFuZCBzYXZpbmcgdGhpcyByb3cgeW91IGNhbiBhZGQgYm9va3MuIElkIHdpbGwgYmUgZ2VuZXJhdGVkIGF1dG9tYXRpY2FsbHkuJyxcbiAgICAgIGdlbnJlczogbnVsbCxcbiAgICAgIGF2YWlsYWJsZTogbnVsbCxcbiAgICAgIHNvbGQ6IG51bGwsXG4gICAgICBwcmljZTogbnVsbCxcbiAgICB9O1xuXG4gICAgdGhpcy5vbkJvb2tFZGl0ZWQgPSAoKSA9PiB7fTtcbiAgICB0aGlzLm9uQm9va0RlbGV0ZWQgPSAoKSA9PiB7fTtcbiAgICB0aGlzLm9uQm9va0FkZGVkID0gKCkgPT4ge307XG4gIH1cblxuICBjcmVhdGVUYWJsZSgpIHtcbiAgICB0aGlzLnRhYmxlID0gY3JlYXRlRWxlbWVudCgndGFibGUnLCAnYm9vay10YWJsZScpO1xuICAgIHRoaXMudGhlYWQgPSBjcmVhdGVFbGVtZW50KCd0aGVhZCcpO1xuICAgIHRoaXMudGJvZHkgPSBjcmVhdGVFbGVtZW50KCd0Ym9keScpO1xuXG4gICAgdGhpcy5jcmVhdGVIZWFkZXJSb3coKTtcbiAgICB0aGlzLnRoZWFkLmFwcGVuZCh0aGlzLmhlYWRlclJvdyk7XG5cbiAgICB0aGlzLnRhYmxlLmFwcGVuZCh0aGlzLnRoZWFkLCB0aGlzLnRib2R5KTtcbiAgfVxuXG4gIGNyZWF0ZUhlYWRlclJvdygpIHtcbiAgICB0aGlzLmhlYWRlclJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICB0aGlzLmhlYWRlcnMuZm9yRWFjaCgoaGVhZGVyKSA9PiB7XG4gICAgICBjb25zdCB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RoJyk7XG4gICAgICB0ZC50ZXh0Q29udGVudCA9IGhlYWRlcjtcbiAgICAgIHRoaXMuaGVhZGVyUm93LmFwcGVuZCh0ZCk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5oZWFkZXJSb3c7XG4gIH1cblxuICBwb3B1bGF0ZVRhYmxlKGJvb2tzKSB7XG4gICAgY29uc3Qgcm93cyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblxuICAgIGNvbnN0IHBsYWNlaG9sZGVyQm9va1JvdyA9IHRoaXMuY3JlYXRlQm9va1Jvdyh0aGlzLnBsYWNlaG9sZGVyQm9vayk7XG4gICAgcm93cy5hcHBlbmQocGxhY2Vob2xkZXJCb29rUm93KTtcblxuICAgIGJvb2tzLmZvckVhY2goKGJvb2spID0+IHtcbiAgICAgIGNvbnN0IHRyID0gdGhpcy5jcmVhdGVCb29rUm93KGJvb2spO1xuICAgICAgcm93cy5hcHBlbmQodHIpO1xuICAgIH0pO1xuXG4gICAgdGhpcy50Ym9keS5pbm5lckhUTUwgPSAnJztcbiAgICB0aGlzLnRib2R5LmFwcGVuZChyb3dzKTtcbiAgfVxuXG4gIGNyZWF0ZUJvb2tSb3coYm9vaykge1xuICAgIGNvbnN0IHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcbiAgICBjb25zdCBlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMoYm9vayk7XG4gICAgY29uc3QgYm9va0lkID0gYm9vay5pZDtcblxuICAgIGVudHJpZXMuZm9yRWFjaCgoZW50cnkpID0+IHtcbiAgICAgIGNvbnN0IFtrZXksIHZhbHVlXSA9IGVudHJ5O1xuICAgICAgY29uc3QgdGQgPSBjcmVhdGVFbGVtZW50KCd0ZCcpO1xuXG4gICAgICBzd2l0Y2ggKGtleSkge1xuICAgICAgICBjYXNlICdkZXNjcmlwdGlvbic6IHtcbiAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBjcmVhdGVFbGVtZW50KCdkaXYnLCAnYm9vay10YWJsZV9fYm9vay1kZXNjcmlwdGlvbicpO1xuICAgICAgICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9IHZhbHVlO1xuICAgICAgICAgIHRkLmFwcGVuZChjb250YWluZXIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNhc2UgJ3ByaWNlJzoge1xuICAgICAgICAgIHRkLnRleHRDb250ZW50ID0gdmFsdWUgPyBgJCR7dmFsdWV9YCA6ICdOb3Qgc3BlY2lmaWVkJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdnZW5yZXMnOiB7XG4gICAgICAgICAgdGQudGV4dENvbnRlbnQgPSB2YWx1ZSA/IHZhbHVlLmpvaW4oJywgJykgOiAnJztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgdGQudGV4dENvbnRlbnQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0ci5hcHBlbmQodGQpO1xuICAgIH0pO1xuXG4gICAgLyogQ29udHJvbCBoYW5kbGluZyAqL1xuICAgIGNvbnN0IGVkaXRhYmxlQ2VsbHMgPSBbLi4udHIuY2hpbGRyZW5dO1xuICAgIGNvbnN0IGNvbnRyb2xzQ2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG5cbiAgICBjb25zdCBidXR0b25zID0gQXJyYXkoNSkuZmlsbCgpLm1hcCgoKSA9PiAoXG4gICAgICBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxuICAgICkpO1xuXG4gICAgY29uc3QgW2VkaXRCdG4sIGNhbmNlbEJ0biwgc2F2ZUJ0biwgZGVsZXRlQnRuLCBjb25maXJtQnRuXSA9IGJ1dHRvbnM7XG4gICAgZWRpdEJ0bi50ZXh0Q29udGVudCA9ICdFZGl0JztcbiAgICBjYW5jZWxCdG4udGV4dENvbnRlbnQgPSAnQ2FuY2VsJztcbiAgICBzYXZlQnRuLnRleHRDb250ZW50ID0gJ1NhdmUnO1xuICAgIGRlbGV0ZUJ0bi50ZXh0Q29udGVudCA9ICdEZWxldGUnO1xuICAgIGNvbmZpcm1CdG4udGV4dENvbnRlbnQgPSAnWWVzJztcblxuICAgIHNldFN0eWxlcyhbY2FuY2VsQnRuLCBjb25maXJtQnRuLCBzYXZlQnRuXSwgJ2Rpc3BsYXknLCAnbm9uZScpO1xuXG4gICAgY29uc3QgY29uZmlybVRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBjb25maXJtVGV4dC50ZXh0Q29udGVudCA9ICdZb3Ugc3VyZSBhYm91dCB0aGF0Pyc7XG4gICAgY29uZmlybVRleHQuaGlkZGVuID0gdHJ1ZTtcblxuICAgIGxldCBjb25maXJtRnVuY3Rpb24gPSBudWxsO1xuXG4gICAgZWRpdEJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGVkaXRhYmxlQ2VsbHMuZm9yRWFjaCgoY2VsbCkgPT4ge1xuICAgICAgICBjZWxsLmNvbnRlbnRFZGl0YWJsZSA9IHRydWU7XG4gICAgICB9KTtcblxuICAgICAgc2V0U3R5bGVzKFtlZGl0QnRuLCBkZWxldGVCdG5dLCAnZGlzcGxheScsICdub25lJyk7XG4gICAgICBzZXRTdHlsZXMoW2NhbmNlbEJ0biwgc2F2ZUJ0bl0sICdkaXNwbGF5JywgJ2lubGluZScpO1xuICAgIH0pO1xuXG4gICAgY2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgdHIucmVwbGFjZVdpdGgodGhpcy5jcmVhdGVCb29rUm93KGJvb2spKTtcbiAgICB9KTtcblxuICAgIHNhdmVCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBjb25zdCBuZXdCb29rID0gT2JqZWN0LmNyZWF0ZShib29rKTtcblxuICAgICAgZWRpdGFibGVDZWxscy5mb3JFYWNoKChjZWxsLCBpKSA9PiB7XG4gICAgICAgIGNlbGwuY29udGVudEVkaXRhYmxlID0gZmFsc2U7XG4gICAgICAgIG5ld0Jvb2tbdGhpcy5jZWxsT3JkZXJbaV1dID0gdGhpcy5leHRyYWN0RGF0YUZyb21DZWxsKGNlbGwsIGkpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKG5ld0Jvb2spO1xuXG4gICAgICBjb25maXJtRnVuY3Rpb24gPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuc3Bpbm5lci50b2dnbGUoKTtcbiAgICAgICAgKCgpID0+IHtcbiAgICAgICAgICBpZiAoYm9va0lkID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vbkJvb2tBZGRlZChuZXdCb29rKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gdGhpcy5vbkJvb2tFZGl0ZWQoYm9va0lkLCBuZXdCb29rKTtcbiAgICAgICAgfSkoKS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgICB0aGlzLnNwaW5uZXIudG9nZ2xlKCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgc2V0U3R5bGVzKFtcbiAgICAgICAgW2NvbmZpcm1UZXh0LCAnZGlzcGxheScsICdibG9jayddLFxuICAgICAgICBbc2F2ZUJ0biwgJ2Rpc3BsYXknLCAnbm9uZSddLFxuICAgICAgICBbY29uZmlybUJ0biwgJ2Rpc3BsYXknLCAnaW5saW5lJ10sXG4gICAgICBdKTtcbiAgICB9KTtcblxuICAgIGRlbGV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGNvbmZpcm1GdW5jdGlvbiA9ICgpID0+IHtcbiAgICAgICAgdGhpcy5zcGlubmVyLnRvZ2dsZSgpO1xuICAgICAgICB0aGlzLm9uQm9va0RlbGV0ZWQoYm9va0lkKVxuICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRyLnJlbW92ZSgpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zcGlubmVyLnRvZ2dsZSgpO1xuICAgICAgICAgIH0pO1xuICAgICAgfTtcblxuICAgICAgc2V0U3R5bGVzKFtlZGl0QnRuLCBkZWxldGVCdG5dLCAnZGlzcGxheScsICdub25lJyk7XG4gICAgICBzZXRTdHlsZXMoW2NhbmNlbEJ0biwgY29uZmlybUJ0bl0sICdkaXNwbGF5JywgJ2lubGluZScpO1xuICAgICAgc2V0U3R5bGVzKFtjb25maXJtVGV4dF0sICdkaXNwbGF5JywgJ2Jsb2NrJyk7XG4gICAgfSk7XG5cbiAgICBjb25maXJtQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgY29uZmlybUZ1bmN0aW9uKCk7XG4gICAgICBjb25maXJtRnVuY3Rpb24gPSBudWxsO1xuXG4gICAgICBzZXRTdHlsZXMoW2NvbmZpcm1UZXh0LCBjb25maXJtQnRuLCBjYW5jZWxCdG5dLCAnZGlzcGxheScsICdub25lJyk7XG4gICAgICBzZXRTdHlsZXMoW2VkaXRCdG4sIGRlbGV0ZUJ0bl0sICdkaXNwbGF5JywgJ2lubGluZScpO1xuICAgIH0pO1xuXG4gICAgY29udHJvbHNDZWxsLmFwcGVuZChjb25maXJtVGV4dCwgZWRpdEJ0biwgY2FuY2VsQnRuLCBjb25maXJtQnRuLCBkZWxldGVCdG4sIHNhdmVCdG4pO1xuICAgIHRyLmFwcGVuZChjb250cm9sc0NlbGwpO1xuICAgIC8qIEVuZCBDb250cm9sIGhhbmRsaW5nICovXG5cbiAgICByZXR1cm4gdHI7XG4gIH1cblxuICBleHRyYWN0RGF0YUZyb21DZWxsKGNlbGwsIGluZGV4SW5DZWxsT3JkZXIpIHtcbiAgICBjb25zdCBjZWxsVHlwZSA9IHRoaXMuY2VsbE9yZGVyW2luZGV4SW5DZWxsT3JkZXJdO1xuXG4gICAgc3dpdGNoIChjZWxsVHlwZSkge1xuICAgICAgY2FzZSAneWVhcic6XG4gICAgICBjYXNlICdzb2xkJzpcbiAgICAgIGNhc2UgJ2F2YWlsYWJsZSc6IHtcbiAgICAgICAgcmV0dXJuIE51bWJlcihjZWxsLnRleHRDb250ZW50KTtcbiAgICAgIH1cbiAgICAgIGNhc2UgJ2dlbnJlcyc6IHtcbiAgICAgICAgY29uc3QgZ2VucmVzU3RyID0gY2VsbC50ZXh0Q29udGVudDtcbiAgICAgICAgY29uc3QgZ2VucmVzID0gZ2VucmVzU3RyLnNwbGl0KC8sXFxzezAsfS8pLmZpbHRlcigoZ2VucmUpID0+IGdlbnJlICE9PSAnJykubWFwKGNhcGl0YWxpemUpO1xuICAgICAgICByZXR1cm4gZ2VucmVzO1xuICAgICAgfVxuICAgICAgY2FzZSAncHJpY2UnOiB7XG4gICAgICAgIGNvbnN0IHRleHQgPSBjZWxsLnRleHRDb250ZW50O1xuICAgICAgICByZXR1cm4gdGV4dFswXSA9PT0gJyQnID8gTnVtYmVyKHRleHQuc2xpY2UoMSkpIDogTnVtYmVyKHRleHQpO1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICByZXR1cm4gY2VsbC50ZXh0Q29udGVudDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gY3JlYXRlRWxlbWVudCh0YWcsIGNsYXNzTmFtZSkge1xuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpO1xuXG4gIGlmIChjbGFzc05hbWUpIHtcbiAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgfVxuXG4gIHJldHVybiBlbGVtZW50O1xufVxuXG5mdW5jdGlvbiBzZXRTdHlsZXMocXVlcmllcywgZGVmYXVsdFN0eWxlLCBkZWZhdWx0VmFsdWUpIHtcbiAgcXVlcmllcy5mb3JFYWNoKChxdWVyeSkgPT4ge1xuICAgIGxldCBlbGVtZW50OyBsZXQgc3R5bGU7IGxldCB2YWx1ZTtcblxuICAgIGlmIChBcnJheS5pc0FycmF5KHF1ZXJ5KSkge1xuICAgICAgW2VsZW1lbnQsIHN0eWxlLCB2YWx1ZV0gPSBxdWVyeTtcbiAgICB9IGVsc2Uge1xuICAgICAgW2VsZW1lbnQsIHN0eWxlLCB2YWx1ZV0gPSBbcXVlcnksIGRlZmF1bHRTdHlsZSwgZGVmYXVsdFZhbHVlXTtcbiAgICB9XG5cbiAgICBlbGVtZW50LnN0eWxlW3N0eWxlXSA9IHZhbHVlO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHIpIHtcbiAgcmV0dXJuIHN0clswXS50b1VwcGVyQ2FzZSgpICsgc3RyLnNsaWNlKDEpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVTcGlubmVyKCkge1xuICBjb25zdCBOVU1CRVJfT0ZfQ0lSQ0xFUyA9IDEyO1xuICBjb25zdCBzcGlubmVyQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHNwaW5uZXJDb250YWluZXIuY2xhc3NOYW1lID0gJ3NwaW5uZXItY29udGFpbmVyJztcblxuICBjb25zdCBzcGlubmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHNwaW5uZXIuY2xhc3NOYW1lID0gJ2xkcy1kZWZhdWx0JztcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IE5VTUJFUl9PRl9DSVJDTEVTOyBpICs9IDEpIHtcbiAgICBjb25zdCBjaXJjbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBzcGlubmVyLmFwcGVuZChjaXJjbGUpO1xuICB9XG5cbiAgc3Bpbm5lckNvbnRhaW5lci50b2dnbGUgPSAoKSA9PiB7XG4gICAgc3Bpbm5lckNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gc3Bpbm5lckNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID09PSAnbm9uZScgPyAnZmxleCcgOiAnbm9uZSc7XG4gIH07XG5cbiAgc3Bpbm5lckNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICBzcGlubmVyQ29udGFpbmVyLmFwcGVuZChzcGlubmVyKTtcblxuICByZXR1cm4gc3Bpbm5lckNvbnRhaW5lcjtcbn1cbiIsImltcG9ydCAnLi9jc3MvbWFpbi5jc3MnO1xuXG5pbXBvcnQgQm9va0xpc3RWaWV3IGZyb20gJy4vbW9kdWxlcy9ib29rLWxpc3QvQm9va0xpc3RWaWV3JztcbmltcG9ydCBCb29rTGlzdENvbnRyb2xsZXIgZnJvbSAnLi9tb2R1bGVzL2Jvb2stbGlzdC9Cb29rTGlzdENvbnRyb2xsZXInO1xuaW1wb3J0IEJvb2tMaXN0TW9kZWwgZnJvbSAnLi9tb2R1bGVzL2Jvb2stbGlzdC9Cb29rTGlzdE1vZGVsJztcblxuY29uc3Qgcm9vdCA9IGRvY3VtZW50LmJvZHk7XG5cbmNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQm9va0xpc3RDb250cm9sbGVyKG5ldyBCb29rTGlzdE1vZGVsKCksIG5ldyBCb29rTGlzdFZpZXcocm9vdCkpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9va0xpc3RDb250cm9sbGVyIHtcbiAgY29uc3RydWN0b3IobW9kZWwsIHZpZXcpIHtcbiAgICB0aGlzLm1vZGVsID0gbW9kZWw7XG4gICAgdGhpcy52aWV3ID0gdmlldztcblxuICAgIHRoaXMubW9kZWwub25Cb29rc1VwZGF0ZWQgPSB0aGlzLm9uQm9va3NVcGRhdGVkLmJpbmQodGhpcyk7XG4gICAgdGhpcy52aWV3Lm9uQm9va0VkaXRlZCA9IHRoaXMub25Cb29rRWRpdGVkLmJpbmQodGhpcyk7XG4gICAgdGhpcy52aWV3Lm9uQm9va0RlbGV0ZWQgPSB0aGlzLm9uQm9va0RlbGV0ZWQuYmluZCh0aGlzKTtcbiAgICB0aGlzLnZpZXcub25Cb29rQWRkZWQgPSB0aGlzLm9uQm9va0FkZGVkLmJpbmQodGhpcyk7XG4gIH1cblxuICBvbkJvb2tzVXBkYXRlZChib29rcykge1xuICAgIHRoaXMudmlldy5wb3B1bGF0ZVRhYmxlKGJvb2tzKTtcbiAgfVxuXG4gIG9uQm9va0VkaXRlZChib29rSWQsIGJvb2spIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbC5lZGl0Qm9va0J5SWQoYm9va0lkLCBib29rKTtcbiAgfVxuXG4gIG9uQm9va0RlbGV0ZWQoYm9va0lkKSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuZGVsZXRlQm9va0J5SWQoYm9va0lkKTtcbiAgfVxuXG4gIG9uQm9va0FkZGVkKGJvb2spIHtcbiAgICByZXR1cm4gdGhpcy5tb2RlbC5hZGRCb29rKGJvb2spO1xuICB9XG59XG4iLCJjb25zdCBBUElfUk9PVCA9ICcvYXBpJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9va0xpc3RNb2RlbCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuYm9va3MgPSBbXTtcbiAgICB0aGlzLnVwZGF0ZUJvb2tzKCk7XG4gICAgdGhpcy5vbkJvb2tzVXBkYXRlZCA9ICgpID0+IHt9O1xuICB9XG5cbiAgdXBkYXRlQm9va3MoKSB7XG4gICAgdGhpcy5jb25zdHJ1Y3Rvci5nZXRCb29rcygpXG4gICAgICAudGhlbigoYm9va3MpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYm9va3MpO1xuICAgICAgICB0aGlzLmJvb2tzID0gYm9va3M7XG4gICAgICAgIHRoaXMub25Cb29rc1VwZGF0ZWQoYm9va3MpO1xuICAgICAgfSk7XG4gIH1cblxuICBzdGF0aWMgZ2V0Qm9va3MoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke0FQSV9ST09UfS9ib29rc2ApXG4gICAgICAudGhlbigocmVzKSA9PiByZXMuanNvbigpKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRCb29rQnlJZChpZCkge1xuICAgIHJldHVybiBmZXRjaChgJHtBUElfUk9PVH0vYm9va3MvJHtpZH1gKVxuICAgICAgLnRoZW4oKHJlcykgPT4gcmVzLmpzb24oKSk7XG4gIH1cblxuICBhZGRCb29rKGJvb2spIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7QVBJX1JPT1R9L2Jvb2tzYCwge1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib29rKSxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZUJvb2tzKCk7XG4gICAgICByZXMuanNvbigpO1xuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlQm9va0J5SWQoaWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7QVBJX1JPT1R9L2Jvb2tzLyR7aWR9YCwgeyBtZXRob2Q6ICdERUxFVEUnIH0pXG4gICAgICAudGhlbigocmVzKSA9PiB7XG4gICAgICAgIHRoaXMudXBkYXRlQm9va3MoKTtcbiAgICAgICAgcmVzLmpzb24oKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgZWRpdEJvb2tCeUlkKGlkLCBib29rKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke0FQSV9ST09UfS9ib29rcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogJ1BVVCcsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib29rKSxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICB0aGlzLnVwZGF0ZUJvb2tzKCk7XG4gICAgICByZXMuanNvbigpO1xuICAgIH0pO1xuICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9